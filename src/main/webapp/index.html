<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>Football Search Engine</title>
    <link href="CSS/Styles.css" rel="stylesheet" />
    <link href="CSS/uploadfile.css" rel="stylesheet" />
    <script src="Vendor/knockout-3.1.0.js"></script>
    <script src="Vendor/jquery-2.1.0.js"></script>
    <script src="Vendor/jquery.uploadfile.js"></script>
    <script src="JS/ObjectDefinitions.js"></script>
    <script src="JS/DataService.js"></script>
    <script src="JS/SearchEngine.js"></script>
    <script type="text/javascript">

        var searchEngine;

        $(document).ready(function () {
            searchEngine = searchEngineViewModel();
            searchEngine.initialize();

            ko.applyBindings(searchEngine);

            // Ctrl-1 pressed
            $(document).keydown(function (e) {
                if (e.ctrlKey && e.keyCode == 49) {
                    searchEngine.toggleDebug();
                }
            });
        });

    </script>
</head>
<body>
    <div id="menuBorder">
        <a class="menuBorderButtonLeft" href="javascript:void(0)" data-bind="click: showSearchPage">Football Search Engine</a>
        <select class="menuBorderUserList" data-bind="options: users, value: loggedUser, optionsText: function(item) { return item.userFullName() }"></select>
        <a class="menuBorderButtonRight" href="javascript:void(0)" data-bind="click: showMyProfile">My Profile</a>
        <a class="menuBorderButtonRight" href="javascript:void(0)" data-bind="click: showMyFiles">My Files</a>
        <a class="menuBorderButtonRight" href="javascript:void(0)" data-bind="click: showUploadFile">Upload File</a>
    </div>
    <div style="height: 40px;"></div>

    <!-- ko if: mode() == 'MyProfile'-->
    <table class="profileTable">
        <thead>
            <tr>
                <th colspan="2">My Profile</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td class="alignRight">Name:</td>
                <td><label data-bind="text: loggedUser() ? loggedUser().name : 'unknown'" /></td>
            </tr>
            <tr>
                <td class="alignRight">Surname:</td>
                <td><label data-bind="text: loggedUser() ? loggedUser().surname : 'unknown'" /></td>
            </tr>
            <tr>
                <td class="alignRight">Country:</td>
                <td><label data-bind="text: loggedUser() ? loggedUser().country : 'unknown'" /></td>
            </tr>
            <tr>
                <td class="alignRight">Sex:</td>
                <td><label data-bind="text: loggedUser() ? loggedUser().sexFormatted() : 'unknown'" /></td>
            </tr>
            <tr>
                <td class="alignRight">Birthday:</td>
                <td><label data-bind="text: loggedUser() ? loggedUser().birthday : 'unknown'" /></td>
            </tr>
        </tbody>
        <tfoot>
            <tr>
                <th><a href="javascript:void(0)" data-bind="click: showUploadFile">Upload File</a></th>
                <th><a href="javascript:void(0)" data-bind="click: showMyFiles">My Files</a></th>
            </tr>
        </tfoot>
    </table>
    <!-- /ko -->
    <!-- ko if: mode() == 'MyFiles' -->
    <div>
        My Files
    </div>
    <!-- /ko -->
    <!-- ko if: mode() == 'UploadFile' -->
    <table class="profileTable">
        <thead>
            <tr>
                <th colspan="2">Upload File</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td class="alignRight" width="120px">Document Title:</td>
                <td><input class="highlightedTextBox" style="width: 100%" type="text" data-bind="value: uploadDocumentTitle, valueUpdate: 'afterkeydown'" /></td>
            </tr>
            <tr>
                <td colspan="2"><div id="fileUploader">Upload</div></td>
            </tr>
        </tbody>
    </table>
    <!-- /ko -->
    <!-- ko if: mode() == 'Search' -->
    <form class="alignCenter" data-bind="submit: performSearch">
        <table id="searchTable">
            <tr>
                <td id="searchLabel"><img id="searchLogo" data-bind="attr: { src: logo }, click: initializeLogo" /></td>
                <td><input class="highlightedTextBox" style="width: 450px" type="text" data-bind="value: searchQuery, valueUpdate: 'afterkeydown'" /></td>
                <td><input class="highlightedButton" style="width: 100px" type="button" value="GO" data-bind="click: performSearch"></td>
            </tr>
            <tr>
                <td colspan="3">
                    <!-- ko if: showSearchResults() == true -->
                    <div class="alignCenter">
                        <a class="searchGroupLinkButton" style="margin-left: 80px;" href="javascript:void(0)" data-bind="click: showALLResultsOnly, style: { fontWeight: isALLSearch() ? 'bold' : '' }">All</a>
                        <a class="searchGroupLinkButton" href="javascript:void(0)" data-bind="click: showDOCResultsOnly, style: { fontWeight: isDOCSearch() ? 'bold' : '' }">Documents</a>
                        <a class="searchGroupLinkButton" href="javascript:void(0)" data-bind="click: showDWResultsOnly, style: { fontWeight: isDWSearch() ? 'bold' : '' }">Data Warehouse</a>
                        <a class="searchGroupLinkButton" href="javascript:void(0)" data-bind="click: showWEBResultsOnly, style: { fontWeight: isWEBSearch() ? 'bold' : '' }">WEB</a>
                    </div>
                    <!--

                        DOCUMENTS RESULTS

                     -->
                    <div class="resultsDIV" data-bind="fadeVisible: searchDocs()">
                        <hr />
                        <div class="resultsGroupHeader">Documents</div>
                        <table style="width: 100%" data-bind="visible: resultsDOC().length > 0">
                            <tbody data-bind="foreach: resultsDOC">
                                <tr data-bind="visible: ($index() < $parent.displayLimit && $parent.isALLSearch()) || $parent.isDOCSearch()">
                                    <td>
                                        Status
                                    </td>
                                    <td>
                                        <label data-bind="text: docPath"></label>
                                    </td>
                                </tr>
                            </tbody>
                            <tfoot data-bind="visible: isALLSearch()">
                                <tr>
                                    <th colspan="2" class="alignRight">
                                        <span class="showMore" data-bind="click: showDOCResultsOnly">show more</span>
                                    </th>
                                </tr>
                            </tfoot>
                        </table>
                        <div class="alignCenter" data-bind="visible: searchDOCinProgress()">
                            <img src="IMG/Loader.gif" alt="" />
                        </div>
                        <div class="noResultsGroupHeader" data-bind="visible: (resultsDOC().length == 0 && !searchDOCinProgress())">
                            Search by Documents returned no results
                        </div>
                    </div>
                    <!--

                        DATA WAREHOUSE RESULTS

                     -->
                    <div class="resultsDIV" data-bind="fadeVisible: searchDW()">
                        <hr />
                        <div class="resultsGroupHeader">Data Warehouse</div>
                        <table style="width: 100%" data-bind="visible: resultsDW().length > 0">
                            <tbody data-bind="foreach: resultsDW">
                                <tr data-bind="visible: ($index() < $parent.displayLimit && $parent.isALLSearch()) || $parent.isDWSearch()">
                                    <td>
                                        Status
                                    </td>
                                    <td></td>
                                </tr>
                            </tbody>
                            <tfoot data-bind="visible: isALLSearch()">
                                <tr>
                                    <th colspan="2" class="alignRight">
                                        <span class="showMore" data-bind="click: showDWResultsOnly">show more</span>
                                    </th>
                                </tr>
                            </tfoot>
                        </table>
                        <div class="alignCenter" data-bind="visible: searchDWinProgress()">
                            <img src="IMG/Loader.gif" alt="" />
                        </div>
                        <div class="noResultsGroupHeader" data-bind="visible: (resultsDW().length == 0 && !searchDWinProgress())">
                            Search by Data Warehouse returned no results
                        </div>
                    </div>
                    <!--

                        WEB RESULTS

                    -->
                    <div class="resultsDIV" data-bind="fadeVisible: searchWEB()">
                        <hr />
                        <div class="resultsGroupHeader">WEB</div>
                        <table style="width: 100%; border-spacing: 0px; border-collapse: separate" data-bind="visible: resultsWEB().length > 0">
                            <tbody data-bind="foreach: resultsWEB">
                                <tr data-bind="visible: ($index() < $parent.displayLimit && $parent.isALLSearch()) || $parent.isWEBSearch()">
                                    <td class="WEBResultsSeparator" style="width: 32px; vertical-align: top;">
                                        <a data-bind="attr: { href: link }">
                                            <img class="iconEntry" data-bind="attr: { src: getIconURL() }" />
                                        </a>
                                    </td>
                                    <td class="WEBResultsSeparator">
                                        <div class="WEBResultEntry">
                                            <div class="WEBResultEntryTitle" data-bind="style: { maxHeight: isExpanded() ? '200px' : '40px' }">
                                                <label data-bind="text: getTitle()"></label><br />
                                            </div>
                                            <a data-bind="attr: { href: userlink }, text: user"></a>
                                            <span data-bind="text: getType()"></span>
                                            <span data-bind="text: getSource()"></span>
                                            <span data-bind="text: getTime()"></span>
                                            <a class="searchGroupLinkButton" href="javascript:void(0)" data-bind="visible: getTitle().length > 190, click: togleExpand, text: isExpanded() ? 'Collapse' : 'Expand'"></a>
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                            <tfoot data-bind="visible: isALLSearch()">
                                <tr>
                                    <th colspan="2" class="alignRight">
                                        <span class="showMore" data-bind="click: showWEBResultsOnly">show more</span>
                                    </th>
                                </tr>
                            </tfoot>
                        </table>
                        <div class="alignCenter" data-bind="visible: searchWEBinProgress()">
                            <img src="IMG/Loader.gif" alt="" />
                        </div>
                        <div class="noResultsGroupHeader" data-bind="visible: (resultsWEB().length == 0 && !searchWEBinProgress())">
                            Search by WEB returned no results
                        </div>
                    </div>
                    <!-- /ko -->
                </td>
            </tr>
        </table>
    </form>
    <!-- /ko -->
    <!-- ko if: showDebug() == 'Yes' -->
    <br />
    <table class="profileTable" style="margin: 0px">
        <thead>
            <tr>
                <th colspan="2">Debug Information</th>
            </tr>
        </thead>
        <tr>
            <td>Logged user ID: </td>
            <td><label data-bind="text: loggedUser() ? loggedUser().id : -1"></label></td>
        </tr>
        <tr>
            <td>Logged user name: </td>
            <td><label data-bind="text: loggedUser() ? loggedUser().userFullName() : 'unknown'"></label></td>
        </tr>
        <tr>
            <td>Search Query: </td>
            <td><label data-bind="text: searchQuery"></label></td>
        </tr>
        <tr>
            <td>Server URL: </td>
            <td><input style="width: 250px" type="text" data-bind="value: serverURL" /></td>
        </tr>
        <tr>
            <td>Background color:</td>
            <td>
                <select data-bind="value: backgroundColor">
                    <option value="white">White</option>
                    <option value="lightgray">Light Gray</option>
                    <option value="#e9eaed">#e9eaed</option>
                </select>
            </td>
        </tr>
    </table>
    <!-- /ko -->
</body>
</html>